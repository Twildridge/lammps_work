# ========== SOLVENT FLOW TEST ==========
# remember that the variables "dataname" and interaction strengths are loaded in via the bash script
# epsSS is solvent–solvent interaction strength
# epsSP is solvent–polymer interaction strength



# ========== Initialization ==========

units lj
dimension 3
boundary p p p
atom_style molecular
atom_modify map array


pair_style lj/cut 2.5
bond_style fene

read_data data_files/equil_${dataname}_${interaction}_${datasteps}.data
comm_modify cutoff 5.0

group polymer type 1 2
group solvent type 3
group support type 4
group mobile subtract all support # everything except support
group polySup type 1 2 4

variable sigma equal 1.0


# ========== Interatomic Potentials ==========
pair_coeff * * 1.0 ${sigma} 2.5
pair_coeff 1 3 ${epsSP} ${sigma} 2.5  # polymer–solvent: weak (poor solvent)
pair_coeff 2 3 ${epsSP} ${sigma} 2.5  # crosslinker–solvent: weak
pair_coeff 3 3 ${epsSS} ${sigma} 2.5  # solvent–solvent
pair_coeff 1 4 1.0 ${sigma} 1.22     # polymer–support (repulsive)
pair_coeff 2 4 1.0 ${sigma} 1.22     # crosslinker–support (repulsive)
pair_coeff 3 4 0.0 ${sigma} 0.0       # solvent–support (NO INTERACTION)
pair_coeff 4 4 0.0 ${sigma} 0.0       # support–support (frozen anyway)

bond_coeff * 40.0 3.0 1.0 1.0

# Freeze support atoms
velocity support set 0.0 0.0 0.0
fix freeze_support support setforce 0.0 0.0 0.0


special_bonds fene
minimize 1.0e-4 1.0e-6 10000 100000



thermo_style custom step temp pe ke etotal press vol lx ly lz
thermo 1000



# ========== Run with Flow ==========

# Apply downward body force to solvent (simulates pressure gradient)
fix push_solvent solvent addforce 0.0 0.0 -0.02

# NPT in lateral directions, NVT in z (flow direction)
# This allows gel to respond mechanically while maintaining flow
fix 1 mobile npt temp 1.0 1.0 1.0 x 0.0 0.0 1.0 y 0.0 0.0 1.0 drag 1.0

timestep 0.005

# Short equilibration with flow
run 2000

# Reset timestep and start measurements
reset_timestep 0

# Track flow properties
compute solvent_vz solvent property/atom vz
compute avg_vz solvent reduce ave c_solvent_vz

# Monitor flow development
thermo_style custom step temp pe ke etotal press vol lx ly lz c_avg_vz
thermo 1000

# Save solvent trajectories to visualize flow
dump solv_traj solvent custom 1000 traj_files/solvent_${dataname}_${interaction}_${nsteps}.lammpstrj id type x y z vx vy vz

dump poly_traj polySup custom 1000 traj_files/polymer_${dataname}_${interaction}_${nsteps}.lammpstrj id type mol x y z

run ${nsteps}

unfix 1
unfix push_solvent
undump poly_traj
undump solv_traj






# ========== Save ==========
#write_data ../equilibrium_slab_observables/data_files/equil_${dataname}_${interaction}_${nsteps}.data


